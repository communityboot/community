<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>字典管理</title>
    <link rel="stylesheet" th:href="@{/webjars/layui/2.5.4/css/layui.css}" media="all">
    <script th:src="@{/static/js/DictUtil.js}"></script>
    <script th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <!-- 内容主体区域 -->
    <div >
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md12">
                    <blockquote class="layui-elem-quote">用户管理</blockquote>
                <hr class="layui-bg-green">
            </div>
        </div>
    </div>
    <div class="layui-fluid">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-sm12 layui-col-md12 layui-col-lg12">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <div class="layui-form toolbar">
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <input id="userName" class="layui-input" type="text" placeholder="用户名" autocomplete="off"/>
                                </div>
                                <div class="layui-inline">
                                    <input id="phone" class="layui-input" type="text" placeholder="手机号" autocomplete="off"/>
                                </div>
                                <div class="layui-inline">
                                    <select id="status">
                                        <option value="">状态</option>
                                        <option value="1">启用</option>
                                        <option value="0">禁用</option>
                                    </select>
                                </div>
                                <div class="layui-inline">
                                    <input id="email" class="layui-input" type="text" placeholder="邮箱" autocomplete="off"/>
                                </div>
                                <div class="layui-inline">
                                    <select id="gender">
                                        <option value="">性别</option>
                                        <option value="1">男</option>
                                        <option value="0">女</option>
                                    </select>
                                </div>
                                <div class="layui-inline">
                                    <button id="btnSearch" class="layui-btn icon-btn"><i class="layui-icon">&#xe615;</i>搜索</button>
                               <!--     <button id="btnAdd" class="layui-btn icon-btn"><i class="layui-icon">&#xe654;</i>添加</button>
                                    <button id="btnBack" class="layui-btn icon-btn layui-btn-warm"><i class="layui-icon">&#x1006;</i>关闭</button>-->
                                </div>
                            </div>
                        </div>
                        <table class="layui-hide" id="dict" lay-filter="dict"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/html" id="toolbarDemo">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm layui-bg-green" lay-event="addDict"><i class="layui-icon layui-icon-add-1"></i>&nbsp;新增</button>
            <button class="layui-btn layui-btn-sm layui-bg-orange" lay-event="modifyDict"><i class="layui-icon layui-icon-edit"></i>&nbsp;修改</button>
            <button class="layui-btn layui-btn-sm layui-bg-red" lay-event="delDict"><i class="layui-icon layui-icon-delete"></i>&nbsp;删除</button>
        </div>
    </script>
</div>
<script type="text/javascript" th:src="@{/webjars/layui/2.5.4/layui.js}" ></script>
<script>
    //JavaScript代码区域
    layui.use('element', function(){
        var element = layui.element;
    });
</script>
<script th:inline="none">
    layui.use('table', function() {
        var table = layui.table;
        table.render({
            elem: '#dict'
            , url: '/user/userQuery'
            //,data:'username:admin'
            , toolbar: '#toolbarDemo'
            , title: '用户表'
            , page: true
            , cols: [[
                {type: 'checkbox', fixed: 'left'}
                , {field: 'userName', title: '用户名', width: 80}
                , {field: 'phone', title: '手机号', width: 160}
                , {field: 'status', title: '状态',templet: function(d) {return getDictTag('dict13')[d.status];}, width: 80}
                , {field: 'email', title: '邮箱', width: 150}
                , {field: 'address', title: '地址', width: 200}
                , {field: 'gender', title: '性别',templet: function(d) {return getGenderDict()[d.gender];}, width: 80}
                , {field: 'birthday', title: '生日', width: 160}
                , {field: 'createTime', title: '创建时间', width: 160}
                , {field: 'remarks', title: '备注', width: 80}
            ]]

        });

        //头工具栏事件
        table.on('toolbar(dict)', function (obj) {
            var $ = layui.jquery;
            var checkStatus = table.checkStatus(obj.config.id);
            switch (obj.event) {
                case 'addDict':
                    var data = checkStatus.data;
                    layer.open({
                        title: "字典信息修改",
                        type: 2,
                        skin: 'layui-layer-rim', //加上边框
                        area: ['700px', '480px'], //宽高
                        content: 'http://localhost:8088/userAdd'
                    });
                    break;
                case 'delDict':
                    var data = checkStatus.data;
                    var arr = [];
                    for (var i = 0; i < data.length; i++) {
                        arr.push(data[i].id);
                    }
                    layer.confirm('确定删除吗？', {
                        btn: ['取消', '确定'] //按钮
                    }, function () {
                        layer.closeAll();
                    }, function () {
                        $.ajax({
                            type: "post",
                            url: "/dict/delBatchDict",
                            dataType: 'json',
                            data: {"ids": arr},
                            success: function (data) {
                                if (data.result === "success") {
                                    layer.msg("删除成功!");
                                    window.parent.location.reload();//修改成功后刷新父界面
                                    layer.closeAll();
                                } else {
                                    layer.msg(data.msg);
                                }
                            }
                        });
                    });
                    break;
                case 'modifyDict':
                    var data = checkStatus.data;
                    if (data.length === 1) {
                        var $ = layui.jquery, form = layui.form;
                        $.ajax({
                            type: "post",
                            url: "/dict/getDictInfo",
                            dataType: 'json',
                            data: "id=" + data[0].id,
                            success: function (data) {
                                if (data.result === "000") {
                                    $("#dictId").val(data.dict.id);
                                    $("#dictName").val(data.dict.dictName);
                                    $("#dictLabel").val(data.dict.dictLabel);
                                    $("input[name=enabled][value= '1']").attr("checked", data.dict.enabled === 1 ? true : false);
                                    $("input[name=enabled][value= '0']").attr("checked", data.dict.enabled === 0 ? true : false)
                                    $("#remark").val(data.dict.remark);
                                    form.render();
                                } else {
                                    layer.msg("信息有误，请检查!");
                                }
                            }
                        });
                        layer.open({
                            title: "字典信息修改",
                            type: 1,
                            skin: 'layui-layer-rim', //加上边框
                            area: ['700px', '480px'], //宽高
                            content: $("#edit")
                        });
                    } else if (data.length === 0) {
                        layer.msg("所选数量为0，请选择需要操作的数据");

                    } else {
                        layer.msg("所选数量超过1，只能对单条数据进行编辑！")
                    }
                    break;
                default:
                    break;
            }
        });
    })
</script>
</body>
</html>